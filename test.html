<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mega Rozbudowana Reklama Popup</title>
<style>
  :root {
    --clr-primary: #4a90e2;
    --clr-secondary: #f5a623;
    --clr-bg-light: #fff;
    --clr-bg-dark: #222;
    --clr-text-light: #222;
    --clr-text-dark: #eee;
    --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    --shadow: 0 4px 15px rgba(0,0,0,0.3);
  }
  body {
    font-family: var(--font-family);
    margin: 0; padding: 0;
    background: var(--clr-bg-dark);
    color: var(--clr-text-dark);
  }

  /* Kontener reklamy */
  .ad-popup {
    position: fixed;
    width: 350px;
    max-width: 90vw;
    background: var(--clr-bg-dark);
    color: var(--clr-text-dark);
    box-shadow: var(--shadow);
    border-radius: 16px;
    overflow: hidden;
    z-index: 9999999;
    font-size: 14px;
    user-select: none;
    display: flex;
    flex-direction: column;
    outline: none;
    opacity: 0;
    transform: translateY(100%) scale(0.8);
    transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .ad-popup.visible {
    opacity: 1;
    transform: translateY(0) scale(1);
  }

  /* Pozycje */
  .pos-bottom-right { bottom: 20px; right: 20px; }
  .pos-bottom-left { bottom: 20px; left: 20px; }
  .pos-top-center { top: 20px; left: 50%; transform: translateX(-50%) scale(0.8); }
  .pos-center { top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.8); }

  /* Tryb jasny/ciemny */
  .theme-dark {
    background: var(--clr-bg-dark);
    color: var(--clr-text-dark);
  }
  .theme-light {
    background: var(--clr-bg-light);
    color: var(--clr-text-light);
  }

  /* NagÅ‚Ã³wek */
  .ad-header {
    padding: 18px 24px;
    font-weight: 700;
    font-size: 20px;
    background: rgba(255 255 255 / 0.1);
    text-align: center;
  }

  /* Obrazek */
  .ad-image {
    width: 100%;
    height: 190px;
    object-fit: cover;
    border-bottom: 1px solid rgba(255 255 255 / 0.1);
    cursor: pointer;
  }

  /* Tekst */
  .ad-message {
    padding: 16px 24px;
    flex-grow: 1;
    line-height: 1.5;
    overflow-y: auto;
  }

  /* Przyciski */
  .ad-actions {
    display: flex;
    gap: 14px;
    padding: 14px 24px;
    background: rgba(0,0,0,0.15);
  }
  .ad-actions button {
    flex: 1;
    border: none;
    border-radius: 12px;
    background: var(--clr-secondary);
    color: #222;
    font-weight: 700;
    cursor: pointer;
    padding: 14px 0;
    box-shadow: 0 3px 9px rgba(0,0,0,0.3);
    transition: background-color 0.25s ease, transform 0.15s ease;
  }
  .ad-actions button:hover, .ad-actions button:focus {
    background: #f7c156;
    outline: none;
  }
  .ad-actions button:active {
    transform: scale(0.96);
  }

  /* Pasek postÄ™pu */
  .ad-progress {
    height: 5px;
    background: var(--clr-primary);
    width: 0%;
    transition: width linear;
  }

  /* Stopka */
  .ad-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(0,0,0,0.25);
    padding: 12px 24px;
    font-size: 13px;
  }
  .ad-footer button {
    background: none;
    border: none;
    color: #ccc;
    font-weight: 600;
    cursor: pointer;
    transition: color 0.3s ease;
  }
  .ad-footer button:disabled {
    color: #666;
    cursor: default;
  }
  .ad-footer button:hover:not(:disabled), .ad-footer button:focus:not(:disabled) {
    color: var(--clr-secondary);
    outline: none;
  }

  /* Tryb cichy - banner dolny */
  .ad-popup.silent {
    width: 100%;
    max-width: none;
    border-radius: 0;
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    top: auto !important;
    transform: translateY(0) scale(1) !important;
    flex-direction: row;
    align-items: center;
    padding: 12px 24px;
    font-size: 16px;
    box-shadow: 0 -3px 12px rgba(0,0,0,0.7);
  }
  .ad-popup.silent .ad-image,
  .ad-popup.silent .ad-message,
  .ad-popup.silent .ad-actions,
  .ad-popup.silent .ad-footer,
  .ad-popup.silent .ad-progress {
    display: none;
  }
  .ad-popup.silent::before {
    content: "ðŸ”¥ Super Promocja! Kliknij, aby dowiedzieÄ‡ siÄ™ wiÄ™cej.";
    flex-grow: 1;
    color: var(--clr-secondary);
    cursor: pointer;
  }

  /* Dodatkowe efekty przyciskÃ³w */
  .btn-mute-toggle {
    font-size: 16px;
    font-weight: 700;
    border-radius: 9999px;
    padding: 6px 12px;
    background: var(--clr-primary);
    color: #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    user-select: none;
  }
</style>
</head>
<body>

<script>
(() => {
  "use strict";

  // --- CONFIG ---
  const config = {
    position: "pos-bottom-right", // pos-bottom-left, pos-top-center, pos-center
    theme: "theme-dark", // theme-dark, theme-light
    silentMode: false,
    language: "pl", // pl, en
    maxDailyShows: 3,
    retryDelaysMinutes: [10, 30, 60], // retry intervals after closing (progressive)
    durationMs: 30000, // how long popup stays open (ms)
  };

  // --- TEXTS ---
  const texts = {
    pl: {
      title: "Super promocja tylko dziÅ›!",
      message: "Nie przegap naszej wyjÄ…tkowej oferty! Kliknij przycisk â€žKup terazâ€ i zyskaj 50% rabatu na wszystkie produkty.",
      btnBuy: "Kup teraz",
      btnMore: "Dowiedz siÄ™ wiÄ™cej",
      btnClose: "Zamknij",
      btnNeverShow: "Nigdy nie pokazuj",
      muteOn: "ðŸ”ˆ DÅºwiÄ™ki: ON",
      muteOff: "ðŸ”‡ DÅºwiÄ™ki: OFF",
      silentBannerText: "ðŸ”¥ Super Promocja! Kliknij, aby dowiedzieÄ‡ siÄ™ wiÄ™cej.",
      ariaLabel: "Okno popup z reklamÄ… promocyjnÄ…",
    },
    en: {
      title: "Super sale just today!",
      message: "Don't miss our special offer! Click 'Buy Now' and get 50% off all products.",
      btnBuy: "Buy Now",
      btnMore: "Learn More",
      btnClose: "Close",
      btnNeverShow: "Never Show Again",
      muteOn: "ðŸ”ˆ Sound: ON",
      muteOff: "ðŸ”‡ Sound: OFF",
      silentBannerText: "ðŸ”¥ Super Sale! Click to learn more.",
      ariaLabel: "Popup window with promotional advertisement",
    }
  };

  // --- STATE ---
  let showCount = 0;
  let retryIndex = 0;
  let isMuted = false;
  let retryTimeout = null;

  // --- STORAGE KEYS ---
  const STORAGE_KEY_SHOWS = "adPopupShows";
  const STORAGE_KEY_MUTE = "adPopupMute";
  const STORAGE_KEY_NEVER_SHOW = "adPopupNeverShow";
  const STORAGE_KEY_LAST_SHOW = "adPopupLastShow";

  // --- SOUNDS ---
  const audioOpen = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
  const audioClose = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_snap.ogg");

  function playSound(sound) {
    if (!isMuted) sound.play().catch(() => {});
  }

  // --- UTILS ---

  // Save and read from localStorage
  function saveToStorage(key, value) {
    try { localStorage.setItem(key, JSON.stringify(value)); } catch {}
  }
  function loadFromStorage(key, def) {
    try {
      const val = localStorage.getItem(key);
      if (val === null) return def;
      return JSON.parse(val);
    } catch { return def; }
  }

  // Increment show count with date reset daily
  function incrementShowCount() {
    const today = new Date().toISOString().slice(0, 10);
    const data = loadFromStorage(STORAGE_KEY_SHOWS, { date: today, count: 0 });
    if (data.date !== today) {
      data.date = today;
      data.count = 0;
    }
    data.count++;
    saveToStorage(STORAGE_KEY_SHOWS, data);
    return data.count;
  }

  function getShowCount() {
    const today = new Date().toISOString().slice(0, 10);
    const data = loadFromStorage(STORAGE_KEY_SHOWS, { date: today, count: 0 });
    if (data.date !== today) return 0;
    return data.count;
  }

  // --- RENDER POPUP ---

  function createPopup() {
    const langText = texts[config.language];

    // Main container
    const popup = document.createElement("div");
    popup.className = `ad-popup ${config.position} ${config.theme}`;
    popup.setAttribute("role", "dialog");
    popup.setAttribute("aria-label", langText.ariaLabel);
    popup.setAttribute("tabindex", "-1");
    popup.style.opacity = "0";
    popup.style.transform = "translateY(100%) scale(0.8)";

    // Silent banner mode
    if (config.silentMode) {
      popup.classList.add("silent");
      popup.textContent = langText.silentBannerText;
      popup.style.cursor = "pointer";
      popup.addEventListener("click", () => {
        openLink();
        closePopup(popup);
      });
      return popup;
    }

    // Header
    const header = document.createElement("div");
    header.className = "ad-header";
    header.textContent = langText.title;
    popup.appendChild(header);

    // Image with lazy loading
    const img = document.createElement("img");
    img.className = "ad-image";
    img.alt = langText.title;
    img.loading = "lazy";
    img.src = "https://picsum.photos/seed/promo/400/200";
    img.tabIndex = 0;
    img.setAttribute("role", "button");
    img.setAttribute("aria-pressed", "false");
    img.addEventListener("click", () => {
      openLink();
      incrementClicks("image");
      closePopup(popup);
    });
    img.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        openLink();
        incrementClicks("image");
        closePopup(popup);
      }
    });
    popup.appendChild(img);

    // Message
    const message = document.createElement("div");
    message.className = "ad-message";
    message.textContent = langText.message;
    popup.appendChild(message);

    // Actions
    const actions = document.createElement("div");
    actions.className = "ad-actions";

    const btnBuy = document.createElement("button");
    btnBuy.textContent = langText.btnBuy;
    btnBuy.addEventListener("click", () => {
      incrementClicks("buy");
      openLink();
      closePopup(popup);
    });
    actions.appendChild(btnBuy);

    const btnMore = document.createElement("button");
    btnMore.textContent = langText.btnMore;
    btnMore.addEventListener("click", () => {
      incrementClicks("more");
      openLink();
      closePopup(popup);
    });
    actions.appendChild(btnMore);

    popup.appendChild(actions);

    // Progress bar
    const progress = document.createElement("div");
    progress.className = "ad-progress";
    popup.appendChild(progress);

    // Footer with close, mute and never-show buttons
    const footer = document.createElement("div");
    footer.className = "ad-footer";

    const btnClose = document.createElement("button");
    btnClose.textContent = langText.btnClose;
    btnClose.addEventListener("click", () => {
      closePopup(popup);
      scheduleRetry();
    });
    footer.appendChild(btnClose);

    const btnMute = document.createElement("button");
    btnMute.className = "btn-mute-toggle";
    btnMute.textContent = isMuted ? langText.muteOff : langText.muteOn;
    btnMute.addEventListener("click", () => {
      isMuted = !isMuted;
      saveToStorage(STORAGE_KEY_MUTE, isMuted);
      btnMute.textContent = isMuted ? langText.muteOff : langText.muteOn;
      console.log(`DÅºwiÄ™ki ${isMuted ? "wyÅ‚Ä…czone" : "wÅ‚Ä…czone"}`);
    });
    footer.appendChild(btnMute);

    const btnNeverShow = document.createElement("button");
    btnNeverShow.textContent = langText.btnNeverShow;
    btnNeverShow.addEventListener("click", () => {
      saveToStorage(STORAGE_KEY_NEVER_SHOW, true);
      closePopup(popup);
    });
    footer.appendChild(btnNeverShow);

    popup.appendChild(footer);

    // Focus trap implementation
    popup.addEventListener("keydown", (e) => {
      if (e.key === "Tab") {
        const focusable = popup.querySelectorAll("button, [tabindex]:not([tabindex='-1']), img[tabindex='0']");
        if (focusable.length === 0) return;
        const first = focusable[0];
        const last = focusable[focusable.length - 1];
        if (e.shiftKey) {
          if (document.activeElement === first) {
            e.preventDefault();
            last.focus();
          }
        } else {
          if (document.activeElement === last) {
            e.preventDefault();
            first.focus();
          }
        }
      }
      if (e.key === "Escape") {
        closePopup(popup);
        scheduleRetry();
      }
    });

    // Play open sound on show
    setTimeout(() => playSound(audioOpen), 100);

    return popup;
  }

  // --- OPEN LINK ---
  function openLink() {
    const url = "https://example.com/promo"; // ZamieÅ„ na wÅ‚asny link
    window.open(url, "_blank", "noopener,noreferrer");
  }

  // --- TRACKING ---
  const clicksStats = { buy: 0, more: 0, image: 0, close: 0 };

  function incrementClicks(type) {
    if (!clicksStats[type]) clicksStats[type] = 0;
    clicksStats[type]++;
    console.log(`KlikniÄ™cia ${type}: ${clicksStats[type]}`);
  }

  // --- CLOSE POPUP ---
  function closePopup(popup) {
    if (!popup) return;
    incrementClicks("close");
    playSound(audioClose);
    popup.classList.remove("visible");
    setTimeout(() => {
      if (popup.parentElement) popup.parentElement.removeChild(popup);
    }, 400);
  }

  // --- SCHEDULE RETRY ---
  function scheduleRetry() {
    if (loadFromStorage(STORAGE_KEY_NEVER_SHOW, false)) return;

    retryIndex = Math.min(retryIndex, config.retryDelaysMinutes.length - 1);
    const delay = config.retryDelaysMinutes[retryIndex] * 60 * 1000;
    retryIndex++;
    console.log(`Reklama pojawi siÄ™ ponownie za ${config.retryDelaysMinutes[retryIndex-1]} minut.`);
    retryTimeout = setTimeout(() => {
      showPopup();
    }, delay);
  }

  // --- SHOW POPUP ---
  function showPopup() {
    if (loadFromStorage(STORAGE_KEY_NEVER_SHOW, false)) {
      console.log("Reklama zostaÅ‚a wyÅ‚Ä…czona na staÅ‚e.");
      return;
    }

    const showsToday = getShowCount();
    if (showsToday >= config.maxDailyShows) {
      console.log("Limit wyÅ›wietleÅ„ reklamy na dziÅ› zostaÅ‚ osiÄ…gniÄ™ty.");
      return;
    }

    retryIndex = 0;

    const popup = createPopup();
    document.body.appendChild(popup);

    // Animate show
    setTimeout(() => {
      popup.classList.add("visible");
      popup.focus();
    }, 50);

    // Animate progress bar
    const progress = popup.querySelector(".ad-progress");
    progress.style.transition = `width ${config.durationMs}ms linear`;
    setTimeout(() => {
      progress.style.width = "100%";
    }, 100);

    // Auto close after duration
    setTimeout(() => {
      closePopup(popup);
      scheduleRetry();
    }, config.durationMs);

    incrementShowCount();
  }

  // --- INITIALIZE ---
  function init() {
    // Load mute state
    isMuted = loadFromStorage(STORAGE_KEY_MUTE, false);

    // Start popup after delay (5s)
    setTimeout(() => {
      showPopup();
    }, 5000);
  }

  // --- RUN ---
  document.addEventListener("DOMContentLoaded", init);
})();
</script>

</body>
</html>
